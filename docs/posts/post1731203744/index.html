<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Web Hackers vs. The Auto Industry: Critical Vulnerabilities in Ferrari, BMW, Rolls Royce, Porsche, and More | jchauhan's writeups</title>
<meta name=keywords content><meta name=description content="https://samcurry.net/web-hackers-vs-the-auto-industry"><meta name=author content="Me :)"><link rel=canonical href=http://localhost:1313/posts/post1731203744/><link crossorigin=anonymous href=/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/post1731203744/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:1313/posts/post1731203744/"><meta property="og:site_name" content="jchauhan's writeups"><meta property="og:title" content="Web Hackers vs. The Auto Industry: Critical Vulnerabilities in Ferrari, BMW, Rolls Royce, Porsche, and More"><meta property="og:description" content="https://samcurry.net/web-hackers-vs-the-auto-industry"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-09T19:55:44-06:00"><meta property="article:modified_time" content="2024-11-09T19:55:44-06:00"><meta property="og:image" content="http://localhost:1313/%3Cimage%20path/url%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Cimage%20path/url%3E"><meta name=twitter:title content="Web Hackers vs. The Auto Industry: Critical Vulnerabilities in Ferrari, BMW, Rolls Royce, Porsche, and More"><meta name=twitter:description content="https://samcurry.net/web-hackers-vs-the-auto-industry"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Web Hackers vs. The Auto Industry: Critical Vulnerabilities in Ferrari, BMW, Rolls Royce, Porsche, and More","item":"http://localhost:1313/posts/post1731203744/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Web Hackers vs. The Auto Industry: Critical Vulnerabilities in Ferrari, BMW, Rolls Royce, Porsche, and More","name":"Web Hackers vs. The Auto Industry: Critical Vulnerabilities in Ferrari, BMW, Rolls Royce, Porsche, and More","description":"https://samcurry.net/web-hackers-vs-the-auto-industry","keywords":[""],"articleBody":"“# Web Hackers vs. The Auto Industry: Critical Vulnerabilities in Ferrari, BMW, Rolls Royce, Porsche, and More\nDuring the fall of 2022, a few friends and I took a road trip from Chicago, IL to Washington, DC to attend a cybersecurity conference and (try) to take a break from our usual computer work.\nWhile we were visiting the University of Maryland, we came across a fleet of electric scooters scattered across the campus and couldn’t resist poking at the scooter’s mobile app. To our surprise, our actions caused the horns and headlights on all of the scooters to turn on and stay on for 15 minutes straight.\nWhen everything eventually settled down, we sent a report over to the scooter manufacturer and became super interested in trying to more ways to make more things honk. We brainstormed for a while, and then realized that nearly every automobile manufactured in the last 5 years had nearly identical functionality. If an attacker were able to find vulnerabilities in the API endpoints that vehicle telematics systems used, they could honk the horn, flash the lights, remotely track, lock/unlock, and start/stop vehicles, completely remotely.\nAt this point, we started a group chat and all began to work with the goal of finding vulnerabilities affecting the automotive industry. Over the next few months, we found as many car-related vulnerabilities as we could. The following writeup details our work exploring the security of telematic systems, automotive APIs, and the infrastructure that supports it.\nFindings Summary During our engagement, we found the following vulnerabilities in the companies listed below:\nKia, Honda, Infiniti, Nissan, Acura\nMercedes-Benz\nHyundai, Genesis\nBMW, Rolls Royce\nFerrari\nSpireon\nFord\nReviver\nPorsche\nToyota\nJaguar, Land Rover\nSiriusXM Connected Vehicle Services\nVulnerability Writeups (1) Full Account Takeover on BMW and Rolls Royce via Misconfigured SSO While testing BMW assets, we identified a custom SSO portal for employees and contractors of BMW. This was super interesting to us, as any vulnerabilities identified here could potentially allow an attacker to compromise any account connected to all of BMWs assets.\nFor instance, if a dealer wanted to access the dealer portal at a physical BMW dealership, they would have to authenticate through this portal. Additionally, this SSO portal was used to access internal tools and related devops infrastructure.\nThe first thing we did was fingerprint the host using OSINT tools like gau and ffuf. After a few hours of fuzzing, we identified a WADL file which exposed API endpoints on the host via sending the following HTTP request:\nGET /rest/api/application.wadl HTTP/1.1 Host: xpita.bmwgroup.com\nThe HTTP response contained all available REST endpoints on the xpita host. We began enumerating the endpoints and sending mock HTTP requests to see what functionality was available.\nOne immediate finding was that we were able to query all BMW user accounts via sending asterisk queries in the user field API endpoint. This allowed us to enter something like “sam*” and retrieve the user information for a user named “sam.curry” without having to guess the actual username.\nHTTP Request\nGET /reset/api/users/example* HTTP/1.1 Host: xpita.bmwgroup.com\nHTTP Response\nHTTP/1.1 200 OK Content-type: application/json {\"id\":\"redacted\",\"firstName\":\"Example\",\"lastName\":\"User\",\"userName\":\"example.user\"} Once we found this vulnerability, we continued testing the other accessible API endpoints. One particularly interesting one which stood out immediately was the “/rest/api/chains/accounts/:user_id/totp” endpoint. We noticed the word “totp” which usually stood for one-time password generation.\nWhen we sent an HTTP request to this endpoint using the SSO user ID gained from the wildcard query paired with the TOTP endpoint, it returned a random 7-digit number. The following HTTP request and response demonstrate this behavior:\nHTTP Request\nGET /rest/api/chains/accounts/unique_account_id/totp HTTP/1.1 Host: xpita.bmwgroup.com\nHTTP Response\nHTTP/1.1 200 OK Content-type: text/plain 9373958\nFor whatever reason, it appeared that this HTTP request would generate a TOTP for the user’s account. We guessed that this interaction worked with the “forgot password” functionality, so we found an example user account by querying “example*” using our original wildcard finding and retrieving the victim user ID. After retrieving this ID, we initiated a reset password attempt for the user account until we got to the point where the system requested a TOTP code from the user’s 2FA device (e.g. email or phone).\nAt this point, we retrieved the TOTP code generated from the API endpoint and entered it into the reset password confirmation field.\nIt worked! We had reset a user account, gaining full account takeover on any BMW employee and contractor user.\nAt this point, it was possible to completely take over any BMW or Rolls Royce employee account and access tools used by those employees.\nTo demonstrate the impact of the vulnerability, we simply Googled “BMW dealer portal” and used our account to access the dealer portal used by sales associates working at physical BMW and Rolls Royce dealerships.\nAfter logging in, we observed that the demo account we took over was tied to an actual dealership, and we could access all of the functionality that the dealers themselves had access to. This included the ability to query a specific VIN number and retrieve sales documents for the vehicle.\nWith our level of access, there was a huge amount of functionality we could’ve performed against BMW and Rolls Royce customer accounts and customer vehicles. We stopped testing at this point and reported the vulnerability.\nThe vulnerabilities reported to BMW and Rolls Royce have since been fixed.\n(2) Remote Code Execution and Access to Hundreds of Internal Tools on Mercedes-Benz and Rolls Royce via Misconfigured SSO Early in our testing, someone in our group had purchased a Mercedes-Benz vehicle and so we began auditing the Mercedes-Benz infrastructure. We took the same approach as BMW and began testing the Mercedes-Benz employee SSO.\nWe weren’t able to find any vulnerabilities affecting the SSO portal itself, but by exploring the SSO website we observed that they were running some form of LDAP for the employee accounts. Based on our high level understanding of their infrastructure, we guessed that the individual employee applications used a centralized LDAP system to authenticate users. We began exploring each of these websites in an attempt to find a public registration so we could gain SSO credentials to access, even at a limited level, the employee applications.\nAfter fuzzing random sites for a while, we eventually found the “umas.mercedes-benz.com” website which was built for vehicle repair shops to request specific tools access from Mercedes-Benz. The website had public registration enabled as it was built for repair shops and appeared to write to the same database as the core employee LDAP system.\nWe filled out all the required fields for registration, created a user account, then used our recon data to identify sites which redirected to the Mercedes-Benz SSO. The first one we attempted was a pretty obvious employee tool, it was “git.mercedes-benz.com”, short for Github. We attempted to use our user credentials to sign in to the Mercedes-Benz Github and saw that we were able to login. Success!\nThe Mercedes-Benz Github, after authenticating, asked us to set up 2FA on our account so we could access the app. We installed the 2FA app and added it to our account, entered our code, then saw that we were in. We had access to “git.mercedes-benz.com” and began looking around.\nAfter a few minutes, we saw that the Github instance had internal documentation and source code for various Mercedes-Benz projects including the Mercedes Me Connect app which was used by customers to remotely connect to their vehicles. The internal documentation gave detailed instructions for employees to follow if they wanted to build an application for Mercedes-Benz themselves to talk to customer vehicles and the specific steps one would have to take to talk to customer vehicles.\nAt this point, we reported the vulnerability, but got some pushback after a few days of waiting on an email response. The team seemed to misunderstand the impact, so they asked us to demonstrate further impact.\nWe used our employee account to login to numerous applications which contained sensitive information and achieved remote code execution via exposed actuators, spring boot consoles, and dozens of sensitive internal applications used by Mercedes-Benz employees. One of these applications was the Mercedes-Benz Mattermost (basically Slack). We had permission to join any channel, including security channels, and could pose as a Mercedes-Benz employee who could ask whatever questions necessary for an actual attacker to elevate their privileges across the Benz infrastructure.\nTo give an overview, we could access the following services:\n(3) Full Account Takeover on Ferrari and Arbitrary Account Creation allows Attacker to Access, Modify, and Delete All Customer Information and Access Administrative CMS Functionality to Manage Ferrari Websites When we began targeting Ferrari, we mapped out all domains under the publicly available domains like “ferrari.com” and browsed around to see what was accessible. One target we found was “api.ferrari.com”, a domain which offered both customer facing and internal APIs for Ferrari systems. Our goal was to get the highest level of access possible for this API.\nWe analyzed the JavaScript present on several Ferrari subdomains that looked like they were for use by Ferrari dealers. These subdomains included cms-dealer.ferrari.com, cms-new.ferrari.com and cms-dealer.test.ferrari.com.\nOne of the patterns we notice when testing web applications is poorly implemented single sign on functionality which does not restrict access to the underlying application. This was the case for the above subdomains. It was possible to extract the JavaScript present for these applications, allowing us to understand the backend API routes in use.\nWhen reverse engineering JavaScript bundles, it is important to check what constants have been defined for the application. Often these constants contain sensitive credentials or at the very least, tell you where the backend API is, that the application talks to.\nFor this application, we noticed the following constants were set:\nconst i = { production: !0, envName: \"production\", version: \"0.0.0\", build: \"20221223T162641363Z\", name: \"ferrari.dws-preowned.backoffice\", formattedName: \"CMS SPINDOX\", feBaseUrl: \"https://{{domain}}.ferraridealers.com/\", fePreownedBaseUrl: \"https://{{domain}}.ferrari.com/\", apiUrl: \"https://api.ferrari.com/cms/dws/back-office/\", apiKey: \"REDACTED\", s3Bucket: \"ferrari-dws-preowned-pro\", cdnBaseUrl: \"https://cdn.ferrari.com/cms/dws/media/\", thronAdvUrl: \"https://ferrari-app-gestioneautousate.thron.com/?fromSAML#/ad/\" } From the above constants we can understand that the base API URL is https://api.ferrari.com/cms/dws/back-office/\\ and a potential API key for this API is REDACTED.\nDigging further into the JavaScript we can look for references to apiUrl which will inform us as to how this API is called and how the API key is being used. For example, the following JavaScript sets certain headers if the API URL is being called:\n})).url.startsWith(x.a.apiUrl) \u0026\u0026 ![\"/back-office/dealers\", \"/back-office/dealer-settings\", \"/back-office/locales\", \"/back-office/currencies\", \"/back-office/dealer-groups\"].some(t =\u003e !!e.url.match(t)) \u0026\u0026 (e = (e = e.clone({ headers: e.headers.set(\"Authorization\", \"\" + (s || void 0)) })).clone({ headers: e.headers.set(\"x-api-key\", \"\" + a) })); All the elements needed for this discovery were conveniently tucked away in this JavaScript file. We knew what backend API to talk to and its routes, as well as the API key we needed to authenticate to the API.\nWithin the JavaScript, we noticed an API call to /cms/dws/back-office/auth/bo-users. When requesting this API through Burp Suite, it leaked all of the users registered for the Ferrari Dealers application. Furthermore, it was possible to send a POST request to this endpoint to add ourselves as a super admin user.\nWhile impactful, we were still looking for a vulnerability that affected the broader Ferrari ecosystem and every end user. Spending more time deconstructing the JavaScript, we found some API calls were being made to rest-connectors:\nreturn t.prototype.getConnectors = function() { return this.httpClient.get(\"rest-connectors\") }, t.prototype.getConnectorById = function(t) { return this.httpClient.get(\"rest-connectors/\" + t) }, t.prototype.createConnector = function(t) { return this.httpClient.post(\"rest-connectors\", t) }, t.prototype.updateConnector = function(t, e) { return this.httpClient.put(\"rest-connectors/\" + t, e) }, t.prototype.deleteConnector = function(t) { return this.httpClient.delete(\"rest-connectors/\" + t) }, t.prototype.getItems = function() { return this.httpClient.get(\"rest-connector-models\") }, t.prototype.getItemById = function(t) { return this.httpClient.get(\"rest-connector-models/\" + t) }, t.prototype.createItem = function(t) { return this.httpClient.post(\"rest-connector-models\", t) }, t.prototype.updateItem = function(t, e) { return this.httpClient.put(\"rest-connector-models/\" + t, e) }, t.prototype.deleteItem = function(t) { return this.httpClient.delete(\"rest-connector-models/\" + t) }, t The following request unlocked the final piece in the puzzle. Sending the following request revealed a treasure trove of API credentials for Ferrari: :\nGET /cms/dws/back-office/rest-connector-models HTTP/1.1 To explain what this endpoint’s purpose was: Ferrari had configured a number of backend APIs that could be communicated with by hitting specific paths. When hitting this API endpoint, it returned this list of API endpoints, hosts and authorization headers (in plain text).\nThis information disclosure allowed us to query Ferrari’s production API to access the personal information of any Ferrari customer. In addition to being able to view these API endpoints, we could also register new rest connectors or modify existing ones.\nHTTP Request\nGET /core/api/v1/Users?email=ian@ian.sh HTTP/1.1 Host: fcd.services.ferrari.com HTTP Response\nHTTP/1.1 200 OK Content-type: application/json …\"guid\":\"2d32922a-28c4-483e-8486-7c2222b7b59c\",\"email\":\"ian@ian.sh\",\"nickName\":\"ian@ian.sh\",\"firstName\":\"Ian\",\"lastName\":\"Carroll\",\"birthdate\":\"1963-12-11T00:00:00\"… The API key and production endpoints that were disclosed using the previous staging API key allowed an attacker to access, create, modify, and delete any production user account. It additionally allowed an attacker to query users via email address or nickname.\nAdditionally, an attacker could POST to the “/core/api/v1/Users/:id/Roles” endpoint to edit their user roles, setting themselves to have super-user permissions or become a Ferrari owner.\nThis vulnerability would allow an attacker to access, modify, and delete any Ferrari customer account with access to manage their vehicle profile.\n(4) SQL Injection and Regex Authorization Bypass on Spireon Systems allows Attacker to Access, Track, and Send Arbitrary Commands to 15 million Telematics systems and Additionally Fully Takeover Fleet Management Systems for Police Departments, Ambulance Services, Truckers, and Many Business Fleet Systems When identifying car-related targets to hack on, we found the company Spireon. In the early 90s and 2000s, there were a few companies like OnStar, Goldstar, and FleetLocate which were standalone devices which were put into vehicles to track and manage them. The devices have the capabilities to be tracked and receive arbitrary commands, e.g. locking the starter so the vehicle cannot start.\nSometime in the past, Spireon had acquired many GPS Vehicle Tracking and Management Companies and put them under the Spireon parent company.\nWe read through the Spireon marketing and saw that they claimed to have over 15 million connected vehicles. They offered services directly to customers and additionally many services through their subsidiary companies like OnStar.\nWe decided to research them as, if an attacker were able to compromise the administration functionality for these devices and fleets, they would be able to perform actions against over 15 million vehicles with very interesting functionalities like sending a cities police officers a dispatch location, disabling vehicle starters, and accessing financial loan information for dealers.\nOur first target for this was very obvious: admin.spireon.com\nThe website appeared to be a very out of date global administration portal for Spireon employees to authenticate and perform some sort of action. We attempted to identify interesting endpoints which were accessible without authorization, but kept getting redirected back to the login.\nSince the website was so old, we tried the trusted manual SQL injection payloads but were kicked out by a WAF that was installed on the system\nWe switched to a much simpler payload: sending an apostrophe, seeing if we got an error, then sending two apostrophes and seeing if we did not get an error. This worked! The system appeared to be reacting to sending an odd versus even number of apostrophes. This indicated that our input in both the username and password field was being passed to a system which could likely be vulnerable to some sort of SQL injection attack.\nFor the username field, we came up with a very simple payload:\nvictim' # The above payload was designed to simply cut off the password check from the SQL query. We sent this HTTP request to Burp Suite’s intruder with a common username list and observed that we received various 301 redirects to “/dashboard” for the username “administrator” and “admin”.\nAfter manually sending the HTTP request using the admin username, we observed that we were authenticated into the Spireon administrator portal as an administrator user. At this point, we browsed around the application and saw many interesting endpoints.\nThe functionality was designed to manage Spireon devices remotely. The administrator user had access to all Spireon devices, including those of OnStar, GoldStar, and FleetLocate. We could query these devices and retrieve the live location of whatever the devices were installed on, and additionally send arbitrary commands to these devices. There was additional functionality to overwrite the device configuration including what servers it reached out to download updated firmware.\nUsing this portal, an attacker could create a malicious Spireon package, update the vehicle configuration to call out to the modified package, then download and install the modified Spireon software.\nAt this point, an attacker could backdoor the Spireon device and run arbitrary commands against the device.\nSince these devices were very ubiquitous and were installed on things like tractors, golf carts, police cars, and ambulances, the impact of each device differed. For some, we could only access the live GPS location of the device, but for others we could disable the starter and send police and ambulance dispatch locations.\nWe reported the vulnerability immediately, but during testing, we observed an HTTP 500 error which disclosed the API URL of the backend API endpoint that the “admin.spireon.com” service reached out to. Initially, we dismissed this as we assumed it was internal, but after circling back we observed that we could hit the endpoint and it would trigger an HTTP 403 forbidden error.\nOur goal now was seeing if we could find some sort of authorization bypass on the host and what endpoints were accessible. By bypassing the administrator UI, we could directly reach out to each device and have direct queries for vehicles and user accounts via the backend API calls.\nWe fuzzed the host and eventually observed some weird behavior:\nBy sending any string with “admin” or “dashboard”, the system would trigger an HTTP 403 forbidden response, but would return 404 if we didn’t include this string. As an example, if we attempted to load “/anything-admin-anything” we’d receive 403 forbidden, while if we attempted to load “/anything-anything” it would return a 404.\nWe took the blacklisted strings, put them in a list, then attempted to enumerate the specific endpoints with fuzzing characters (%00 to %FF) stuck behind the first and last characters.\nDuring scanning, we saw that the following HTTP requests would return a 200 OK response:\nGET /%0dadmin GET /%0ddashboard\nThrough Burp Suite, we sent the HTTP response to our browser and observed the response: it was a full administrative portal for the core Spireon app. We quickly set up a match and replace rule to modify GET /admin and GET /dashboard to the endpoints with the %0d prefix.\nAfter setting up this rule, we could browse to “/admin” or “/dashboard” and explore the website without having to perform any additional steps. We observed that there were dozens of endpoints which were used to query all connected vehicles, send arbitrary commands to connected vehicles, and view all customer tenant accounts, fleet accounts, and customer accounts. We had access to everything.\nAt this point, a malicious actor could backdoor the 15 million devices, query what ownership information was associated with a specific VIN, retrieve the full user information for all customer accounts, and invite themselves to manage any fleet which was connected to the app.\nFor our proof of concept, we invited ourselves to a random fleet account and saw that we received an invitation to administrate a US Police Department where we could track the entire police fleet.\n(5) Mass Assignment on Reviver allows an Attacker to Remotely Track and Overwrite the Virtual License Plates for All Reviver Customers, Track and Administrate Reviver Fleets, and Access, Modify, and Delete All User Information In October, 2022, California announced that it had legalized digital license plates. We researched this for a while and found that most, if not all of the digital license plates, were done through a company called Reviver.\nIf someone wanted a digital license plate, they’d buy the virtual Reviver license plate which included a SIM card for remotely tracking and updating the license plate. Customers who uses Reviver could remotely update their license plates slogan, background, and additionally report if the car had been stolen via setting the plate tag to “STOLEN”.\nSince the license plate could be used to track vehicles, we were super interested in Reviver and began auditing the mobile app. We proxied the HTTP traffic and saw that all API functionality was done on the “pr-api.rplate.com” website. After creating a user account, our user account was assigned to a unique “company” JSON object which allowed us to add other sub-users to our account.\nThe company JSON object was super interesting as we could update many of the JSON fields within the object. One of these fields was called “type” and was default set to “CONSUMER”. After noticing this, we dug through the app source code in hopes that we could find another value to set it to, but were unsuccessful.\nAt this point, we took a step back and wondered if there was an actual website we could talk to versus proxying traffic through the mobile app. We looked online for a while before getting the idea to perform a reset password on our account which gave us a URL to navigate to.\nOnce we opened the password reset URL, we observed that the website had tons of functionality including the ability to administer vehicles, fleets, and user accounts. This was super interesting as we now had a lot more API endpoints and functionality to access. Additionally, the JavaScript on the website appeared to have the names of the other roles that our user account could be (e.g. specialized names for user, moderator, admin, etc.)\nWe queried the “CONSUMER” string in the JavaScript and saw that there were other roles that were defined in the JavaScript. After attempting to update our “role” parameter to the disclosed “CORPORATE” role, we refreshed out profile metadata, then saw that it was successful! We were able to change our roles to ones other than the default user account, opening the door to potential privilige escalation vulnerabilities.\nIt appeared that, even though we had updated our account to the “CORPORATE” role, we were still receiving authorization vulnerabilities when logging into the website. We thought for a while until realizing that we could invite users to our modified account which had the elevated role, which may then grant the invited users the required permissions since they were invited via an intended way versus mass assigning an account to an elevated role.\nAfter inviting a new account, accepting the invitation, and logging into the account, we observed that we no longer received authorization errors and could access fleet management functionality. This meant that we could likely (1) mass assign our account to an even higher elevated role (e.g. admin), then (2) invite a user to our account which would be assigned the appropriate permissions.\nThis perplexed us as there was likely some administration group which existed in the system but that we had not yet identified. We brute forced the “type” parameter using wordlists until we noticed that setting our group to the number “4” had updated our role to “REVIVER_ROLE”. It appeared that the roles were indexed to numbers, and we could simply run through the numbers 0-100 and find all the roles on the website.\nThe “0” role was the string “REVIVER”, and after setting this on our account and re-inviting a new user, we logged into the website normally and observed that the UI was completely broken and we couldn’t click any buttons. From what we could guess, we had the administrator role but were accessing the account using the customer facing frontend website and not the appropriate administrator frontend website. We would have to find the endpoints used by administrators ourselves.\nSince our administrator account theoretically had elevated permissions, our first test was simply querying a user account and seeing if we could access someone else’s data: this worked!\nWe could take any of the normal API calls (viewing vehicle location, updating vehicle plates, adding new users to accounts) and perform the action using our super administrator account with full authorization.\nAt this point, we reported the vulnerability and observed that it was patched in under 24 hours. An actual attacker could remotely update, track, or delete anyone’s REVIVER plate. We could additionally access any dealer (e.g. Mercedes-Benz dealerships will often package REVIVER plates) and update the default image used by the dealer when the newly purchased vehicle still had DEALER tags.\nThe Reviver website also offered fleet management functionality which we had full access to.\n(6) Full Remote Vehicle Access and Full Account Takeover affecting Hyundai and Genesis This vulnerability was written up on Twitter and can be accessed on the following thread:\nWe recently found a vulnerability affecting Hyundai and Genesis vehicles where we could remotely control the locks, engine, horn, headlights, and trunk of vehicles made after 2012.\nTo explain how it worked and how we found it, we have @specters as our mock car thief: pic.twitter.com/WWyY6vFoAF### (7) Full Remote Vehicle Access and Full Account Takeover affecting Honda, Nissan, Infiniti, Acura\nThis vulnerability was written up on Twitter and can be accessed on the following thread:\nMore car hacking!\nEarlier this year, we were able to remotely unlock, start, locate, flash, and honk any remotely connected Honda, Nissan, Infiniti, and Acura vehicles, completely unauthorized, knowing only the VIN number of the car.\nHere’s how we found it, and how it works: pic.twitter.com/ul3A4sT47k### (8) Full Vehicle Takeover on Nissan via Mass Assignment\nThis vulnerability was written up on Twitter and can be accessed on the following thread:\nGood Morning, I feel like we need more car haxs. So here is another vulnerability we found that got us remote commands on every internet connected Nissan \u0026 Infiniti. Bug was fixed.\nshout out to @samwcyo @bbuerhaus @sshell_ @d0nutptr @xEHLE_ @iangcarroll @sshell_ @infosec_au pic.twitter.com/5TbC9G1Oxk## Credits\nThe following people contributed towards this project:\nSpecial thanks to the following people who helped create this blog post:”\n","wordCount":"4326","inLanguage":"en","image":"http://localhost:1313/%3Cimage%20path/url%3E","datePublished":"2024-11-09T19:55:44-06:00","dateModified":"2024-11-09T19:55:44-06:00","author":{"@type":"Person","name":"Me :)"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/post1731203744/"},"publisher":{"@type":"Organization","name":"jchauhan's writeups","logo":{"@type":"ImageObject","url":"http://localhost:1313/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/categories/ title=categories><span>categories</span></a></li><li><a href=http://localhost:1313/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Web Hackers vs. The Auto Industry: Critical Vulnerabilities in Ferrari, BMW, Rolls Royce, Porsche, and More</h1><div class=post-description>https://samcurry.net/web-hackers-vs-the-auto-industry</div><div class=post-meta><span title='2024-11-09 19:55:44 -0600 CST'>November 9, 2024</span>&nbsp;·&nbsp;21 min&nbsp;·&nbsp;4326 words&nbsp;·&nbsp;Me :)&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/post1731203744.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=http://localhost:1313/%3Cimage%20path/url%3E alt><p></p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#findings-summary>Findings Summary</a></li><li><a href=#vulnerability-writeups>Vulnerability Writeups</a><ul><li><a href=#1-full-account-takeover-on-bmw-and-rolls-royce-via-misconfigured-sso>(1) Full Account Takeover on BMW and Rolls Royce via Misconfigured SSO</a></li><li><a href=#2-remote-code-execution-and-access-to-hundreds-of-internal-tools-on-mercedes-benz-and-rolls-royce-via-misconfigured-sso>(2) Remote Code Execution and Access to Hundreds of Internal Tools on Mercedes-Benz and Rolls Royce via Misconfigured SSO</a></li><li><a href=#3-full-account-takeover-on-ferrari-and-arbitrary-account-creation-allows-attacker-to-access-modify-and-delete-all-customer-information-and-access-administrative-cms-functionality-to-manage-ferrari-websites>(3) Full Account Takeover on Ferrari and Arbitrary Account Creation allows Attacker to Access, Modify, and Delete All Customer Information and Access Administrative CMS Functionality to Manage Ferrari Websites</a></li><li><a href=#4-sql-injection-and-regex-authorization-bypass-on-spireon-systems-allows-attacker-to-access-track-and-send-arbitrary-commands-to-15-million-telematics-systems-and-additionally-fully-takeover-fleet-management-systems-for-police-departments-ambulance-services-truckers-and-many-business-fleet-systems>(4) SQL Injection and Regex Authorization Bypass on Spireon Systems allows Attacker to Access, Track, and Send Arbitrary Commands to 15 million Telematics systems and Additionally Fully Takeover Fleet Management Systems for Police Departments, Ambulance Services, Truckers, and Many Business Fleet Systems</a></li><li><a href=#5-mass-assignment-on-reviver-allows-an-attacker-to-remotely-track-and-overwrite-the-virtual-license-plates-for-all-reviver-customers-track-and-administrate-reviver-fleets-and-access-modify-and-delete-all-user-information>(5) Mass Assignment on Reviver allows an Attacker to Remotely Track and Overwrite the Virtual License Plates for All Reviver Customers, Track and Administrate Reviver Fleets, and Access, Modify, and Delete All User Information</a></li><li><a href=#6-full-remote-vehicle-access-and-full-account-takeover-affecting-hyundai-and-genesis>(6) Full Remote Vehicle Access and Full Account Takeover affecting Hyundai and Genesis</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>&ldquo;# Web Hackers vs. The Auto Industry: Critical Vulnerabilities in Ferrari, BMW, Rolls Royce, Porsche, and More</p><p>During the fall of 2022, a few friends and I took a road trip from Chicago, IL to Washington, DC to attend a cybersecurity conference and (try) to take a break from our usual computer work.</p><p>While we were visiting the University of Maryland, we came across a fleet of electric scooters scattered across the campus and couldn&rsquo;t resist poking at the scooter&rsquo;s mobile app. To our surprise, our actions caused the horns and headlights on all of the scooters to turn on and stay on for 15 minutes straight.</p><p>When everything eventually settled down, we sent a report over to the scooter manufacturer and became super interested in trying to more ways to make more things honk. We brainstormed for a while, and then realized that nearly every automobile manufactured in the last 5 years had nearly identical functionality. If an attacker were able to find vulnerabilities in the API endpoints that vehicle telematics systems used, they could honk the horn, flash the lights, remotely track, lock/unlock, and start/stop vehicles, completely remotely.</p><p>At this point, we started a group chat and all began to work with the goal of finding vulnerabilities affecting the automotive industry. Over the next few months, we found as many car-related vulnerabilities as we could. The following writeup details our work exploring the security of telematic systems, automotive APIs, and the infrastructure that supports it.</p><h2 id=findings-summary>Findings Summary<a hidden class=anchor aria-hidden=true href=#findings-summary>#</a></h2><p>During our engagement, we found the following vulnerabilities in the companies listed below:</p><p>Kia, Honda, Infiniti, Nissan, Acura</p><p>Mercedes-Benz</p><p>Hyundai, Genesis</p><p>BMW, Rolls Royce</p><p>Ferrari</p><p>Spireon</p><p>Ford</p><p>Reviver</p><p>Porsche</p><p>Toyota</p><p>Jaguar, Land Rover</p><p>SiriusXM Connected Vehicle Services</p><h2 id=vulnerability-writeups>Vulnerability Writeups<a hidden class=anchor aria-hidden=true href=#vulnerability-writeups>#</a></h2><h3 id=1-full-account-takeover-on-bmw-and-rolls-royce-via-misconfigured-sso>(1) Full Account Takeover on BMW and Rolls Royce via Misconfigured SSO<a hidden class=anchor aria-hidden=true href=#1-full-account-takeover-on-bmw-and-rolls-royce-via-misconfigured-sso>#</a></h3><p>While testing BMW assets, we identified a custom SSO portal for employees and contractors of BMW. This was super interesting to us, as any vulnerabilities identified here could potentially allow an attacker to compromise any account connected to all of BMWs assets.</p><p>For instance, if a dealer wanted to access the dealer portal at a physical BMW dealership, they would have to authenticate through this portal. Additionally, this SSO portal was used to access internal tools and related devops infrastructure.</p><p>The first thing we did was fingerprint the host using OSINT tools like gau and ffuf. After a few hours of fuzzing, we identified a WADL file which exposed API endpoints on the host via sending the following HTTP request:</p><p>GET /rest/api/application.wadl HTTP/1.1 Host: xpita.bmwgroup.com</p><p>The HTTP response contained all available REST endpoints on the xpita host. We began enumerating the endpoints and sending mock HTTP requests to see what functionality was available.</p><p>One immediate finding was that we were able to query all BMW user accounts via sending asterisk queries in the user field API endpoint. This allowed us to enter something like &ldquo;sam*&rdquo; and retrieve the user information for a user named &ldquo;sam.curry&rdquo; without having to guess the actual username.</p><p>HTTP Request</p><p>GET /reset/api/users/example* HTTP/1.1 Host: xpita.bmwgroup.com</p><p>HTTP Response</p><pre tabindex=0><code>HTTP/1.1 200 OK Content-type: application/json {&#34;id&#34;:&#34;redacted&#34;,&#34;firstName&#34;:&#34;Example&#34;,&#34;lastName&#34;:&#34;User&#34;,&#34;userName&#34;:&#34;example.user&#34;}
</code></pre><p>Once we found this vulnerability, we continued testing the other accessible API endpoints. One particularly interesting one which stood out immediately was the &ldquo;/rest/api/chains/accounts/:user_id/totp&rdquo; endpoint. We noticed the word &ldquo;totp&rdquo; which usually stood for one-time password generation.</p><p>When we sent an HTTP request to this endpoint using the SSO user ID gained from the wildcard query paired with the TOTP endpoint, it returned a random 7-digit number. The following HTTP request and response demonstrate this behavior:</p><p>HTTP Request</p><p>GET /rest/api/chains/accounts/unique_account_id/totp HTTP/1.1 Host: xpita.bmwgroup.com</p><p>HTTP Response</p><p>HTTP/1.1 200 OK Content-type: text/plain 9373958</p><p>For whatever reason, it appeared that this HTTP request would generate a TOTP for the user&rsquo;s account. We guessed that this interaction worked with the &ldquo;forgot password&rdquo; functionality, so we found an example user account by querying &ldquo;example*&rdquo; using our original wildcard finding and retrieving the victim user ID. After retrieving this ID, we initiated a reset password attempt for the user account until we got to the point where the system requested a TOTP code from the user&rsquo;s 2FA device (e.g. email or phone).</p><p>At this point, we retrieved the TOTP code generated from the API endpoint and entered it into the reset password confirmation field.</p><p>It worked! We had reset a user account, gaining full account takeover on any BMW employee and contractor user.</p><p>At this point, it was possible to completely take over any BMW or Rolls Royce employee account and access tools used by those employees.</p><p>To demonstrate the impact of the vulnerability, we simply Googled &ldquo;BMW dealer portal&rdquo; and used our account to access the dealer portal used by sales associates working at physical BMW and Rolls Royce dealerships.</p><p>After logging in, we observed that the demo account we took over was tied to an actual dealership, and we could access all of the functionality that the dealers themselves had access to. This included the ability to query a specific VIN number and retrieve sales documents for the vehicle.</p><p>With our level of access, there was a huge amount of functionality we could&rsquo;ve performed against BMW and Rolls Royce customer accounts and customer vehicles. We stopped testing at this point and reported the vulnerability.</p><p>The vulnerabilities reported to BMW and Rolls Royce have since been fixed.</p><h3 id=2-remote-code-execution-and-access-to-hundreds-of-internal-tools-on-mercedes-benz-and-rolls-royce-via-misconfigured-sso>(2) Remote Code Execution and Access to Hundreds of Internal Tools on Mercedes-Benz and Rolls Royce via Misconfigured SSO<a hidden class=anchor aria-hidden=true href=#2-remote-code-execution-and-access-to-hundreds-of-internal-tools-on-mercedes-benz-and-rolls-royce-via-misconfigured-sso>#</a></h3><p>Early in our testing, someone in our group had purchased a Mercedes-Benz vehicle and so we began auditing the Mercedes-Benz infrastructure. We took the same approach as BMW and began testing the Mercedes-Benz employee SSO.</p><p>We weren&rsquo;t able to find any vulnerabilities affecting the SSO portal itself, but by exploring the SSO website we observed that they were running some form of LDAP for the employee accounts. Based on our high level understanding of their infrastructure, we guessed that the individual employee applications used a centralized LDAP system to authenticate users. We began exploring each of these websites in an attempt to find a public registration so we could gain SSO credentials to access, even at a limited level, the employee applications.</p><p>After fuzzing random sites for a while, we eventually found the &ldquo;umas.mercedes-benz.com&rdquo; website which was built for vehicle repair shops to request specific tools access from Mercedes-Benz. The website had public registration enabled as it was built for repair shops and appeared to write to the same database as the core employee LDAP system.</p><p>We filled out all the required fields for registration, created a user account, then used our recon data to identify sites which redirected to the Mercedes-Benz SSO. The first one we attempted was a pretty obvious employee tool, it was &ldquo;git.mercedes-benz.com&rdquo;, short for Github. We attempted to use our user credentials to sign in to the Mercedes-Benz Github and saw that we were able to login. Success!</p><p>The Mercedes-Benz Github, after authenticating, asked us to set up 2FA on our account so we could access the app. We installed the 2FA app and added it to our account, entered our code, then saw that we were in. We had access to &ldquo;git.mercedes-benz.com&rdquo; and began looking around.</p><p>After a few minutes, we saw that the Github instance had internal documentation and source code for various Mercedes-Benz projects including the Mercedes Me Connect app which was used by customers to remotely connect to their vehicles. The internal documentation gave detailed instructions for employees to follow if they wanted to build an application for Mercedes-Benz themselves to talk to customer vehicles and the specific steps one would have to take to talk to customer vehicles.</p><p>At this point, we reported the vulnerability, but got some pushback after a few days of waiting on an email response. The team seemed to misunderstand the impact, so they asked us to demonstrate further impact.</p><p>We used our employee account to login to numerous applications which contained sensitive information and achieved remote code execution via exposed actuators, spring boot consoles, and dozens of sensitive internal applications used by Mercedes-Benz employees. One of these applications was the Mercedes-Benz Mattermost (basically Slack). We had permission to join any channel, including security channels, and could pose as a Mercedes-Benz employee who could ask whatever questions necessary for an actual attacker to elevate their privileges across the Benz infrastructure.</p><p>To give an overview, we could access the following services:</p><h3 id=3-full-account-takeover-on-ferrari-and-arbitrary-account-creation-allows-attacker-to-access-modify-and-delete-all-customer-information-and-access-administrative-cms-functionality-to-manage-ferrari-websites>(3) Full Account Takeover on Ferrari and Arbitrary Account Creation allows Attacker to Access, Modify, and Delete All Customer Information and Access Administrative CMS Functionality to Manage Ferrari Websites<a hidden class=anchor aria-hidden=true href=#3-full-account-takeover-on-ferrari-and-arbitrary-account-creation-allows-attacker-to-access-modify-and-delete-all-customer-information-and-access-administrative-cms-functionality-to-manage-ferrari-websites>#</a></h3><p>When we began targeting Ferrari, we mapped out all domains under the publicly available domains like &ldquo;ferrari.com&rdquo; and browsed around to see what was accessible. One target we found was &ldquo;api.ferrari.com&rdquo;, a domain which offered both customer facing and internal APIs for Ferrari systems. Our goal was to get the highest level of access possible for this API.</p><p>We analyzed the JavaScript present on several Ferrari subdomains that looked like they were for use by Ferrari dealers. These subdomains included <code>cms-dealer.ferrari.com</code>, <code>cms-new.ferrari.com</code> and <code>cms-dealer.test.ferrari.com</code>.</p><p>One of the patterns we notice when testing web applications is poorly implemented single sign on functionality which does not restrict access to the underlying application. This was the case for the above subdomains. It was possible to extract the JavaScript present for these applications, allowing us to understand the backend API routes in use.</p><p>When reverse engineering JavaScript bundles, it is important to check what constants have been defined for the application. Often these constants contain sensitive credentials or at the very least, tell you where the backend API is, that the application talks to.</p><p>For this application, we noticed the following constants were set:</p><pre tabindex=0><code>const i = { 
    production: !0, 
    envName: &#34;production&#34;, 
    version: &#34;0.0.0&#34;, 
    build: &#34;20221223T162641363Z&#34;, 
    name: &#34;ferrari.dws-preowned.backoffice&#34;, 
    formattedName: &#34;CMS SPINDOX&#34;, 
    feBaseUrl: &#34;https://{{domain}}.ferraridealers.com/&#34;, 
    fePreownedBaseUrl: &#34;https://{{domain}}.ferrari.com/&#34;, 
    apiUrl: &#34;https://api.ferrari.com/cms/dws/back-office/&#34;, 
    apiKey: &#34;REDACTED&#34;, 
    s3Bucket: &#34;ferrari-dws-preowned-pro&#34;, 
    cdnBaseUrl: &#34;https://cdn.ferrari.com/cms/dws/media/&#34;, 
    thronAdvUrl: &#34;https://ferrari-app-gestioneautousate.thron.com/?fromSAML#/ad/&#34; 
}
</code></pre><p>From the above constants we can understand that the base API URL is <code>https://api.ferrari.com/cms/dws/back-office/\</code> and a potential API key for this API is <code>REDACTED</code>.</p><p>Digging further into the JavaScript we can look for references to <code>apiUrl</code> which will inform us as to how this API is called and how the API key is being used. For example, the following JavaScript sets certain headers if the API URL is being called:</p><pre tabindex=0><code>})).url.startsWith(x.a.apiUrl) &amp;&amp; ![&#34;/back-office/dealers&#34;, &#34;/back-office/dealer-settings&#34;, &#34;/back-office/locales&#34;, &#34;/back-office/currencies&#34;, &#34;/back-office/dealer-groups&#34;].some(t =&gt; !!e.url.match(t)) &amp;&amp; (e = (e = e.clone({ 
    headers: e.headers.set(&#34;Authorization&#34;, &#34;&#34; + (s || void 0)) 
})).clone({ 
    headers: e.headers.set(&#34;x-api-key&#34;, &#34;&#34; + a) 
}));
</code></pre><p>All the elements needed for this discovery were conveniently tucked away in this JavaScript file. We knew what backend API to talk to and its routes, as well as the API key we needed to authenticate to the API.</p><p>Within the JavaScript, we noticed an API call to <code>/cms/dws/back-office/auth/bo-users</code>. When requesting this API through Burp Suite, it leaked all of the users registered for the Ferrari Dealers application. Furthermore, it was possible to send a POST request to this endpoint to add ourselves as a super admin user.</p><p>While impactful, we were still looking for a vulnerability that affected the broader Ferrari ecosystem and every end user. Spending more time deconstructing the JavaScript, we found some API calls were being made to <code>rest-connectors</code>:</p><pre tabindex=0><code>return t.prototype.getConnectors = function() {
    return this.httpClient.get(&#34;rest-connectors&#34;)
}, t.prototype.getConnectorById = function(t) {
    return this.httpClient.get(&#34;rest-connectors/&#34; + t)
}, t.prototype.createConnector = function(t) {
    return this.httpClient.post(&#34;rest-connectors&#34;, t)
}, t.prototype.updateConnector = function(t, e) {
    return this.httpClient.put(&#34;rest-connectors/&#34; + t, e)
}, t.prototype.deleteConnector = function(t) {
    return this.httpClient.delete(&#34;rest-connectors/&#34; + t)
}, t.prototype.getItems = function() {
    return this.httpClient.get(&#34;rest-connector-models&#34;)
}, t.prototype.getItemById = function(t) {
    return this.httpClient.get(&#34;rest-connector-models/&#34; + t)
}, t.prototype.createItem = function(t) {
    return this.httpClient.post(&#34;rest-connector-models&#34;, t)
}, t.prototype.updateItem = function(t, e) {
    return this.httpClient.put(&#34;rest-connector-models/&#34; + t, e)
}, t.prototype.deleteItem = function(t) {
    return this.httpClient.delete(&#34;rest-connector-models/&#34; + t)
}, t
</code></pre><p>The following request unlocked the final piece in the puzzle. Sending the following request revealed a treasure trove of API credentials for Ferrari: :</p><pre tabindex=0><code>GET /cms/dws/back-office/rest-connector-models HTTP/1.1
</code></pre><p>To explain what this endpoint&rsquo;s purpose was: Ferrari had configured a number of backend APIs that could be communicated with by hitting specific paths. When hitting this API endpoint, it returned this list of API endpoints, hosts and authorization headers (in plain text).</p><p>This information disclosure allowed us to query Ferrari&rsquo;s production API to access the personal information of any Ferrari customer. In addition to being able to view these API endpoints, we could also register new rest connectors or modify existing ones.</p><p>HTTP Request</p><pre tabindex=0><code>GET /core/api/v1/Users?email=ian@ian.sh HTTP/1.1
Host: fcd.services.ferrari.com
</code></pre><p>HTTP Response</p><pre tabindex=0><code>HTTP/1.1 200 OK Content-type: application/json

…&#34;guid&#34;:&#34;2d32922a-28c4-483e-8486-7c2222b7b59c&#34;,&#34;email&#34;:&#34;ian@ian.sh&#34;,&#34;nickName&#34;:&#34;ian@ian.sh&#34;,&#34;firstName&#34;:&#34;Ian&#34;,&#34;lastName&#34;:&#34;Carroll&#34;,&#34;birthdate&#34;:&#34;1963-12-11T00:00:00&#34;…
</code></pre><p>The API key and production endpoints that were disclosed using the previous staging API key allowed an attacker to access, create, modify, and delete any production user account. It additionally allowed an attacker to query users via email address or nickname.</p><p>Additionally, an attacker could POST to the &ldquo;/core/api/v1/Users/:id/Roles&rdquo; endpoint to edit their user roles, setting themselves to have super-user permissions or become a Ferrari owner.</p><p>This vulnerability would allow an attacker to access, modify, and delete any Ferrari customer account with access to manage their vehicle profile.</p><h3 id=4-sql-injection-and-regex-authorization-bypass-on-spireon-systems-allows-attacker-to-access-track-and-send-arbitrary-commands-to-15-million-telematics-systems-and-additionally-fully-takeover-fleet-management-systems-for-police-departments-ambulance-services-truckers-and-many-business-fleet-systems>(4) SQL Injection and Regex Authorization Bypass on Spireon Systems allows Attacker to Access, Track, and Send Arbitrary Commands to 15 million Telematics systems and Additionally Fully Takeover Fleet Management Systems for Police Departments, Ambulance Services, Truckers, and Many Business Fleet Systems<a hidden class=anchor aria-hidden=true href=#4-sql-injection-and-regex-authorization-bypass-on-spireon-systems-allows-attacker-to-access-track-and-send-arbitrary-commands-to-15-million-telematics-systems-and-additionally-fully-takeover-fleet-management-systems-for-police-departments-ambulance-services-truckers-and-many-business-fleet-systems>#</a></h3><p>When identifying car-related targets to hack on, we found the company Spireon. In the early 90s and 2000s, there were a few companies like OnStar, Goldstar, and FleetLocate which were standalone devices which were put into vehicles to track and manage them. The devices have the capabilities to be tracked and receive arbitrary commands, e.g. locking the starter so the vehicle cannot start.</p><p>Sometime in the past, Spireon had acquired many GPS Vehicle Tracking and Management Companies and put them under the Spireon parent company.</p><p>We read through the Spireon marketing and saw that they claimed to have over 15 million connected vehicles. They offered services directly to customers and additionally many services through their subsidiary companies like OnStar.</p><p>We decided to research them as, if an attacker were able to compromise the administration functionality for these devices and fleets, they would be able to perform actions against over 15 million vehicles with very interesting functionalities like sending a cities police officers a dispatch location, disabling vehicle starters, and accessing financial loan information for dealers.</p><p>Our first target for this was very obvious: admin.spireon.com</p><p>The website appeared to be a very out of date global administration portal for Spireon employees to authenticate and perform some sort of action. We attempted to identify interesting endpoints which were accessible without authorization, but kept getting redirected back to the login.</p><p>Since the website was so old, we tried the trusted manual SQL injection payloads but were kicked out by a WAF that was installed on the system</p><p>We switched to a much simpler payload: sending an apostrophe, seeing if we got an error, then sending two apostrophes and seeing if we did not get an error. This worked! The system appeared to be reacting to sending an odd versus even number of apostrophes. This indicated that our input in both the username and password field was being passed to a system which could likely be vulnerable to some sort of SQL injection attack.</p><p>For the username field, we came up with a very simple payload:</p><pre tabindex=0><code>victim&#39; #
</code></pre><p>The above payload was designed to simply cut off the password check from the SQL query. We sent this HTTP request to Burp Suite&rsquo;s intruder with a common username list and observed that we received various 301 redirects to &ldquo;/dashboard&rdquo; for the username &ldquo;administrator&rdquo; and &ldquo;admin&rdquo;.</p><p>After manually sending the HTTP request using the admin username, we observed that we were authenticated into the Spireon administrator portal as an administrator user. At this point, we browsed around the application and saw many interesting endpoints.</p><p>The functionality was designed to manage Spireon devices remotely. The administrator user had access to all Spireon devices, including those of OnStar, GoldStar, and FleetLocate. We could query these devices and retrieve the live location of whatever the devices were installed on, and additionally send arbitrary commands to these devices. There was additional functionality to overwrite the device configuration including what servers it reached out to download updated firmware.</p><p>Using this portal, an attacker could create a malicious Spireon package, update the vehicle configuration to call out to the modified package, then download and install the modified Spireon software.</p><p>At this point, an attacker could backdoor the Spireon device and run arbitrary commands against the device.</p><p>Since these devices were very ubiquitous and were installed on things like tractors, golf carts, police cars, and ambulances, the impact of each device differed. For some, we could only access the live GPS location of the device, but for others we could disable the starter and send police and ambulance dispatch locations.</p><p>We reported the vulnerability immediately, but during testing, we observed an HTTP 500 error which disclosed the API URL of the backend API endpoint that the &ldquo;admin.spireon.com&rdquo; service reached out to. Initially, we dismissed this as we assumed it was internal, but after circling back we observed that we could hit the endpoint and it would trigger an HTTP 403 forbidden error.</p><p>Our goal now was seeing if we could find some sort of authorization bypass on the host and what endpoints were accessible. By bypassing the administrator UI, we could directly reach out to each device and have direct queries for vehicles and user accounts via the backend API calls.</p><p>We fuzzed the host and eventually observed some weird behavior:</p><p>By sending any string with &ldquo;admin&rdquo; or &ldquo;dashboard&rdquo;, the system would trigger an HTTP 403 forbidden response, but would return 404 if we didn&rsquo;t include this string. As an example, if we attempted to load &ldquo;/anything-admin-anything&rdquo; we&rsquo;d receive 403 forbidden, while if we attempted to load &ldquo;/anything-anything&rdquo; it would return a 404.</p><p>We took the blacklisted strings, put them in a list, then attempted to enumerate the specific endpoints with fuzzing characters (%00 to %FF) stuck behind the first and last characters.</p><p>During scanning, we saw that the following HTTP requests would return a 200 OK response:</p><p>GET /%0dadmin GET /%0ddashboard</p><p>Through Burp Suite, we sent the HTTP response to our browser and observed the response: it was a full administrative portal for the core Spireon app. We quickly set up a match and replace rule to modify GET /admin and GET /dashboard to the endpoints with the %0d prefix.</p><p>After setting up this rule, we could browse to &ldquo;/admin&rdquo; or &ldquo;/dashboard&rdquo; and explore the website without having to perform any additional steps. We observed that there were dozens of endpoints which were used to query all connected vehicles, send arbitrary commands to connected vehicles, and view all customer tenant accounts, fleet accounts, and customer accounts. We had access to everything.</p><p>At this point, a malicious actor could backdoor the 15 million devices, query what ownership information was associated with a specific VIN, retrieve the full user information for all customer accounts, and invite themselves to manage any fleet which was connected to the app.</p><p>For our proof of concept, we invited ourselves to a random fleet account and saw that we received an invitation to administrate a US Police Department where we could track the entire police fleet.</p><h3 id=5-mass-assignment-on-reviver-allows-an-attacker-to-remotely-track-and-overwrite-the-virtual-license-plates-for-all-reviver-customers-track-and-administrate-reviver-fleets-and-access-modify-and-delete-all-user-information>(5) Mass Assignment on Reviver allows an Attacker to Remotely Track and Overwrite the Virtual License Plates for All Reviver Customers, Track and Administrate Reviver Fleets, and Access, Modify, and Delete All User Information<a hidden class=anchor aria-hidden=true href=#5-mass-assignment-on-reviver-allows-an-attacker-to-remotely-track-and-overwrite-the-virtual-license-plates-for-all-reviver-customers-track-and-administrate-reviver-fleets-and-access-modify-and-delete-all-user-information>#</a></h3><p>In October, 2022, California announced that it had legalized digital license plates. We researched this for a while and found that most, if not all of the digital license plates, were done through a company called Reviver.</p><p>If someone wanted a digital license plate, they&rsquo;d buy the virtual Reviver license plate which included a SIM card for remotely tracking and updating the license plate. Customers who uses Reviver could remotely update their license plates slogan, background, and additionally report if the car had been stolen via setting the plate tag to &ldquo;STOLEN&rdquo;.</p><p>Since the license plate could be used to track vehicles, we were super interested in Reviver and began auditing the mobile app. We proxied the HTTP traffic and saw that all API functionality was done on the &ldquo;pr-api.rplate.com&rdquo; website. After creating a user account, our user account was assigned to a unique &ldquo;company&rdquo; JSON object which allowed us to add other sub-users to our account.</p><p>The company JSON object was super interesting as we could update many of the JSON fields within the object. One of these fields was called &ldquo;type&rdquo; and was default set to &ldquo;CONSUMER&rdquo;. After noticing this, we dug through the app source code in hopes that we could find another value to set it to, but were unsuccessful.</p><p>At this point, we took a step back and wondered if there was an actual website we could talk to versus proxying traffic through the mobile app. We looked online for a while before getting the idea to perform a reset password on our account which gave us a URL to navigate to.</p><p>Once we opened the password reset URL, we observed that the website had tons of functionality including the ability to administer vehicles, fleets, and user accounts. This was super interesting as we now had a lot more API endpoints and functionality to access. Additionally, the JavaScript on the website appeared to have the names of the other roles that our user account could be (e.g. specialized names for user, moderator, admin, etc.)</p><p>We queried the &ldquo;CONSUMER&rdquo; string in the JavaScript and saw that there were other roles that were defined in the JavaScript. After attempting to update our &ldquo;role&rdquo; parameter to the disclosed &ldquo;CORPORATE&rdquo; role, we refreshed out profile metadata, then saw that it was successful! We were able to change our roles to ones other than the default user account, opening the door to potential privilige escalation vulnerabilities.</p><p>It appeared that, even though we had updated our account to the &ldquo;CORPORATE&rdquo; role, we were still receiving authorization vulnerabilities when logging into the website. We thought for a while until realizing that we could invite users to our modified account which had the elevated role, which may then grant the invited users the required permissions since they were invited via an intended way versus mass assigning an account to an elevated role.</p><p>After inviting a new account, accepting the invitation, and logging into the account, we observed that we no longer received authorization errors and could access fleet management functionality. This meant that we could likely (1) mass assign our account to an even higher elevated role (e.g. admin), then (2) invite a user to our account which would be assigned the appropriate permissions.</p><p>This perplexed us as there was likely some administration group which existed in the system but that we had not yet identified. We brute forced the &ldquo;type&rdquo; parameter using wordlists until we noticed that setting our group to the number &ldquo;4&rdquo; had updated our role to &ldquo;REVIVER_ROLE&rdquo;. It appeared that the roles were indexed to numbers, and we could simply run through the numbers 0-100 and find all the roles on the website.</p><p>The &ldquo;0&rdquo; role was the string &ldquo;REVIVER&rdquo;, and after setting this on our account and re-inviting a new user, we logged into the website normally and observed that the UI was completely broken and we couldn&rsquo;t click any buttons. From what we could guess, we had the administrator role but were accessing the account using the customer facing frontend website and not the appropriate administrator frontend website. We would have to find the endpoints used by administrators ourselves.</p><p>Since our administrator account theoretically had elevated permissions, our first test was simply querying a user account and seeing if we could access someone else&rsquo;s data: this worked!</p><p>We could take any of the normal API calls (viewing vehicle location, updating vehicle plates, adding new users to accounts) and perform the action using our super administrator account with full authorization.</p><p>At this point, we reported the vulnerability and observed that it was patched in under 24 hours. An actual attacker could remotely update, track, or delete anyone&rsquo;s REVIVER plate. We could additionally access any dealer (e.g. Mercedes-Benz dealerships will often package REVIVER plates) and update the default image used by the dealer when the newly purchased vehicle still had DEALER tags.</p><p>The Reviver website also offered fleet management functionality which we had full access to.</p><h3 id=6-full-remote-vehicle-access-and-full-account-takeover-affecting-hyundai-and-genesis>(6) Full Remote Vehicle Access and Full Account Takeover affecting Hyundai and Genesis<a hidden class=anchor aria-hidden=true href=#6-full-remote-vehicle-access-and-full-account-takeover-affecting-hyundai-and-genesis>#</a></h3><p>This vulnerability was written up on Twitter and can be accessed on the following thread:</p><p>We recently found a vulnerability affecting Hyundai and Genesis vehicles where we could remotely control the locks, engine, horn, headlights, and trunk of vehicles made after 2012.</p><p>To explain how it worked and how we found it, we have @<em>specters</em> as our mock car thief: pic.twitter.com/WWyY6vFoAF### (7) Full Remote Vehicle Access and Full Account Takeover affecting Honda, Nissan, Infiniti, Acura</p><p>This vulnerability was written up on Twitter and can be accessed on the following thread:</p><p>More car hacking!</p><p>Earlier this year, we were able to remotely unlock, start, locate, flash, and honk any remotely connected Honda, Nissan, Infiniti, and Acura vehicles, completely unauthorized, knowing only the VIN number of the car.</p><p>Here&rsquo;s how we found it, and how it works: pic.twitter.com/ul3A4sT47k### (8) Full Vehicle Takeover on Nissan via Mass Assignment</p><p>This vulnerability was written up on Twitter and can be accessed on the following thread:</p><p>Good Morning, I feel like we need more car haxs. So here is another vulnerability we found that got us remote commands on every internet connected Nissan & Infiniti. Bug was fixed.</p><p>shout out to @samwcyo @bbuerhaus @sshell_ @d0nutptr @xEHLE_ @iangcarroll @sshell_ @infosec_au pic.twitter.com/5TbC9G1Oxk## Credits</p><p>The following people contributed towards this project:</p><p>Special thanks to the following people who helped create this blog post:&rdquo;</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/post1731203805/><span class=title>« Prev</span><br><span>Space policy is about to get pretty wild, y’all - Ars Technica</span>
</a><a class=next href=http://localhost:1313/posts/post1731203662/><span class=title>Next »</span><br><span>TALOS-2024-1975 || Cisco Talos Intelligence Group - Comprehensive Threat Intelligence</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>jchauhan's writeups</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>