<!doctype html><html lang=en dir=auto><head><script src="/blog/livereload.js?mindelay=10&amp;v=2&amp;port=443&amp;path=blog/livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Setting up Raspberry Pi router | jc's blog</title>
<meta name=keywords content="raspberry,pi,router,self,hosted"><meta name=description content="Setting up Rpi router for customizable firewall"><meta name=author content="Me"><link rel=canonical href=https://jchauhn.github.io:443/blog/posts/rpirouter/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.580b14abcdff654725dca950fc193a94af9a059724b1c7face549d539b70bd7d.css integrity="sha256-WAsUq83/ZUcl3KlQ/Bk6lK+aBZckscf6zlSdU5twvX0=" rel="preload stylesheet" as=style><link rel=icon href=https://jchauhn.github.io:443/blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jchauhn.github.io:443/blog/favicon1616.ico><link rel=icon type=image/png sizes=32x32 href=https://jchauhn.github.io:443/blog/favicon3232.ico><link rel=apple-touch-icon href=https://jchauhn.github.io:443/blog/apple-touch-icon.png><link rel=mask-icon href=https://jchauhn.github.io:443/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://jchauhn.github.io:443/blog/posts/rpirouter/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://jchauhn.github.io:443/blog/posts/rpirouter/"><meta property="og:site_name" content="jc's blog"><meta property="og:title" content="Setting up Raspberry Pi router"><meta property="og:description" content="Setting up Rpi router for customizable firewall"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-31T11:30:03+00:00"><meta property="article:modified_time" content="2024-12-31T11:30:03+00:00"><meta property="article:tag" content="Raspberry"><meta property="article:tag" content="Pi"><meta property="article:tag" content="Router"><meta property="article:tag" content="Self"><meta property="article:tag" content="Hosted"><meta property="og:image" content="https://jchauhn.github.io:443/blog/%3Cimage%20path/url%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jchauhn.github.io:443/blog/%3Cimage%20path/url%3E"><meta name=twitter:title content="Setting up Raspberry Pi router"><meta name=twitter:description content="Setting up Rpi router for customizable firewall"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://jchauhn.github.io:443/blog/posts/"},{"@type":"ListItem","position":2,"name":"Setting up Raspberry Pi router","item":"https://jchauhn.github.io:443/blog/posts/rpirouter/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Setting up Raspberry Pi router","name":"Setting up Raspberry Pi router","description":"Setting up Rpi router for customizable firewall","keywords":["raspberry","pi","router","self","hosted"],"articleBody":"Introduction A customizable router is hard to find. Netgear, Cisco, TP-Link (well not anymore) all make decent routers however their management interfaces leave a lot to be desired. What I wanted was simple:-\n1. Customizable Firewall Rules 2. GUI Interface 3. Remote Management 4. NO SUBSCRIPTION Cisco, Netgear have pretty good enterprise olutions but all of them require a subscription. Which is preposterous. I decided that rather than spending over 130 dollars on a new wifi AP, I can use the an old raspberry pi. Raspberry Pi fits my requiremtns becuase I only need a few devices and don’t require very high bandwidth.\nSetup Flashed Raspbian onto the raspberry pi using their default installer which is pretty good and GUI friendly. Alternate command is to download the raspbian ISO from the website and flash using dd\nsudo dd if=/path/to/ISO of=/dev/diskX bs=4M status=progress \u0026\u0026 sync The SD card will be located at /dev/diskX where X is a number. Identify using diskutil list bs=4M byte size 4 million. Relates to the chunking of data. Lower means faster write speeds status lets you know how long is left sync ensure that all the data is written before the process is closed. Once installed, start up raspbian and connect to the ethernet. ensuring everything is working.\nInterface. sudo ip link set eth0 down sudo ip link set wlan0 down sudo apt install dnsmasq hostapd iptables-persistent dnsmasq provides DHCP service. Automatically assigns IP addresses and other configuration information to devices on a network hostapd: host access point daemon iptables: firewall software. needs persistent to survive reboots iwconfig Starting the wifi service\nAdd the following lines to the /etc/dhcpcd.conf - the dhcpcd configration file.\ninterface wlan0 static ip_address=192.168.4.1/24 nohook wpa_supplicant hostapd setup Add the following to /etc/hostapd/hostapd.conf\ninterface=wlan0 driver=nl80211 ssid=MyPiAccessPoint hw_mode=g channel=6 auth_algs=1 wpa=2 wpa_key_mgmt=WPA-PSK wpa_passphrase=yourpassword rsn_pairwise=CCMP nas_identifier=anystringworks This is the configration of hostapd. Most of the key values are self explanatory. nas_identifier is the name providing network access in a Wi-Fi network\nAdd the following to /etc/default/hostapd\nDAEMON_CONF=\"/etc/hostapd/hostapd.conf\" sudo systemctl stop dnsmasq sudo nano /etc/dnsmasq.conf add the following to\ninterface=wlan0 # Listening on wlan0 dhcp-range=192.168.4.2,192.168.4.20,255.255.255.0,24h Fix systemctl Edit /etc/sysctl.conf add\nnet.ipv4.ip_forward=1 restart using sudo sysctl -p\nFirewall systems sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE sudo iptables -A FORWARD -i wlan0 -o eth0 -m state --state RELATED,ESTABLISHED -j ACCEPT sudo iptables -A FORWARD -i eth0 -o wlan0 -j ACCEPT sudo sh -c 'iptables-save \u003e /etc/iptables/rules.v4' -t nat: Specifies the nat table, which is used for Network Address Translation. -A POSTROUTING: Appends a rule to the POSTROUTING chain, which handles packets as they leave the machine. -o eth0: Specifies the outgoing interface (your public-facing network interface). -j MASQUERADE: Uses the MASQUERADE target, which automatically replaces the source IP address of outgoing packets with the IP address of the outgoing interface (eth0). -m state: look at the state of the connection --state RELATED,ESTABLISHED: Looking at the state of the connection. only allow for related or established\nFinal steps sudo systemctl enable hostapd sudo systemctl enable dnsmasq sudo systemctl start hostapd sudo systemctl start dnsmasq Try running ifconfig wlan0. Should see a ipv4 address. If not troubleshoot lol.\n","wordCount":"523","inLanguage":"en","image":"https://jchauhn.github.io:443/blog/%3Cimage%20path/url%3E","datePublished":"2024-12-31T11:30:03Z","dateModified":"2024-12-31T11:30:03Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://jchauhn.github.io:443/blog/posts/rpirouter/"},"publisher":{"@type":"Organization","name":"jc's blog","logo":{"@type":"ImageObject","url":"https://jchauhn.github.io:443/blog/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><br></nav></header><div class=layout-with-left-panel><div class=left-panel><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><div id=left-panel><h1>jc's blog</h1><p class=infoblob>Collection of personal ideas & arcane reseach</p><a class=corelink href=/blog/posts>Posts</a>
<a class=corelink href=/blog>About</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div></div><main class=main><div class=content-area><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Setting up Raspberry Pi router</h1><div class=post-description>Setting up Rpi router for customizable firewall</div><div class=post-meta><span title='2024-12-31 11:30:03 +0000 +0000'>December 31, 2024</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;523 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/rpirouter.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://jchauhn.github.io:443/blog/%3Cimage%20path/url%3E alt><p></p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a><ul><li></li></ul></li><li><a href=#setup>Setup</a></li><li><a href=#interface>Interface.</a><ul><li><a href=#hostapd-setup>hostapd setup</a></li><li><a href=#fix-systemctl>Fix systemctl</a></li><li><a href=#firewall-systems>Firewall systems</a></li><li><a href=#final-steps>Final steps</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>A customizable router is hard to find. Netgear, Cisco, TP-Link (well not anymore) all make decent routers however their management interfaces leave a lot to be desired.
What I wanted was simple:-</p><h4 id=1-customizable-firewall-rules>1. Customizable Firewall Rules<a hidden class=anchor aria-hidden=true href=#1-customizable-firewall-rules>#</a></h4><h4 id=2-gui-interface>2. GUI Interface<a hidden class=anchor aria-hidden=true href=#2-gui-interface>#</a></h4><h4 id=3-remote-management>3. Remote Management<a hidden class=anchor aria-hidden=true href=#3-remote-management>#</a></h4><h4 id=4-no-subscription>4. NO SUBSCRIPTION<a hidden class=anchor aria-hidden=true href=#4-no-subscription>#</a></h4><p>Cisco, Netgear have pretty good enterprise olutions but all of them require a subscription. Which is preposterous.
I decided that rather than spending over 130 dollars on a new wifi AP, I can use the an old raspberry pi.
Raspberry Pi fits my requiremtns becuase I only need a few devices and don&rsquo;t require very high bandwidth.</p><h2 id=setup>Setup<a hidden class=anchor aria-hidden=true href=#setup>#</a></h2><p>Flashed Raspbian onto the raspberry pi using their default installer which is pretty good and GUI friendly.
Alternate command is to download the raspbian ISO from the <a href=https://www.raspberrypi.com/software/operating-systems/>website</a>
and flash using <code>dd</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo dd if=/path/to/ISO of=/dev/diskX bs=4M status=progress &amp;&amp; sync
</span></span></code></pre></div><ul><li>The SD card will be located at <code>/dev/diskX</code> where X is a number. Identify using <code>diskutil list</code></li><li><code>bs=4M</code> byte size 4 million. Relates to the chunking of data. Lower means faster write speeds</li><li><code>status</code> lets you know how long is left</li><li><code>sync</code> ensure that all the data is written before the process is closed.</li></ul><p>Once installed, start up raspbian and connect to the ethernet. ensuring everything is working.</p><h2 id=interface>Interface.<a hidden class=anchor aria-hidden=true href=#interface>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo ip link set eth0 down
</span></span><span class=line><span class=cl>sudo ip link set wlan0 down
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo apt install dnsmasq hostapd iptables-persistent
</span></span></code></pre></div><ol><li><strong>dnsmasq</strong> provides DHCP service. Automatically assigns IP addresses and other configuration information to devices on a network</li><li><strong>hostapd</strong>: host access point daemon</li><li><strong>iptables</strong>: firewall software. needs persistent to survive reboots</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>iwconfig
</span></span></code></pre></div><p>Starting the wifi service</p><p>Add the following lines to the <code>/etc/dhcpcd.conf</code> - the dhcpcd configration file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>interface wlan0
</span></span><span class=line><span class=cl>  static ip_address=192.168.4.1/24
</span></span><span class=line><span class=cl>  nohook wpa_supplicant
</span></span></code></pre></div><h3 id=hostapd-setup>hostapd setup<a hidden class=anchor aria-hidden=true href=#hostapd-setup>#</a></h3><p>Add the following to <code>/etc/hostapd/hostapd.conf</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>interface=wlan0
</span></span><span class=line><span class=cl>driver=nl80211
</span></span><span class=line><span class=cl>ssid=MyPiAccessPoint
</span></span><span class=line><span class=cl>hw_mode=g
</span></span><span class=line><span class=cl>channel=6
</span></span><span class=line><span class=cl>auth_algs=1
</span></span><span class=line><span class=cl>wpa=2
</span></span><span class=line><span class=cl>wpa_key_mgmt=WPA-PSK
</span></span><span class=line><span class=cl>wpa_passphrase=yourpassword
</span></span><span class=line><span class=cl>rsn_pairwise=CCMP
</span></span><span class=line><span class=cl>nas_identifier=anystringworks
</span></span></code></pre></div><p>This is the configration of hostapd. Most of the key values are self explanatory.
nas_identifier is the name providing network access in a Wi-Fi network</p><p>Add the following to <code>/etc/default/hostapd</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>DAEMON_CONF=&#34;/etc/hostapd/hostapd.conf&#34;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo systemctl stop dnsmasq
</span></span><span class=line><span class=cl>sudo nano /etc/dnsmasq.conf
</span></span></code></pre></div><p>add the following to</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>interface=wlan0      # Listening on wlan0
</span></span><span class=line><span class=cl>dhcp-range=192.168.4.2,192.168.4.20,255.255.255.0,24h
</span></span></code></pre></div><h3 id=fix-systemctl>Fix systemctl<a hidden class=anchor aria-hidden=true href=#fix-systemctl>#</a></h3><p>Edit <code>/etc/sysctl.conf</code>
add</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>net.ipv4.ip_forward=1
</span></span></code></pre></div><p>restart using <code>sudo sysctl -p</code></p><h3 id=firewall-systems>Firewall systems<a hidden class=anchor aria-hidden=true href=#firewall-systems>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
</span></span><span class=line><span class=cl>sudo iptables -A FORWARD -i wlan0 -o eth0 -m state --state RELATED,ESTABLISHED -j ACCEPT
</span></span><span class=line><span class=cl>sudo iptables -A FORWARD -i eth0 -o wlan0 -j ACCEPT
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo sh -c &#39;iptables-save &gt; /etc/iptables/rules.v4&#39;
</span></span></code></pre></div><p><code>-t nat</code>: Specifies the nat table, which is used for Network Address Translation.
<code>-A POSTROUTING</code>: Appends a rule to the POSTROUTING chain, which handles packets as they leave the machine.
<code>-o eth0</code>: Specifies the outgoing interface (your public-facing network interface).
<code>-j MASQUERADE</code>: Uses the MASQUERADE target, which automatically replaces the source IP address of outgoing packets with the IP address of the outgoing interface (eth0).
<code>-m state</code>: look at the state of the connection
<code>--state RELATED,ESTABLISHED</code>: Looking at the state of the connection. only allow for related or established</p><h3 id=final-steps>Final steps<a hidden class=anchor aria-hidden=true href=#final-steps>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo systemctl enable hostapd
</span></span><span class=line><span class=cl>sudo systemctl enable dnsmasq
</span></span><span class=line><span class=cl>sudo systemctl start hostapd
</span></span><span class=line><span class=cl>sudo systemctl start dnsmasq
</span></span></code></pre></div><p>Try running <code>ifconfig wlan0</code>. Should see a ipv4 address. If not troubleshoot lol.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://jchauhn.github.io:443/blog/tags/raspberry/>Raspberry</a></li><li><a href=https://jchauhn.github.io:443/blog/tags/pi/>Pi</a></li><li><a href=https://jchauhn.github.io:443/blog/tags/router/>Router</a></li><li><a href=https://jchauhn.github.io:443/blog/tags/self/>Self</a></li><li><a href=https://jchauhn.github.io:443/blog/tags/hosted/>Hosted</a></li></ul><nav class=paginav><a class=prev href=https://jchauhn.github.io:443/blog/posts/tornadocash/><span class=title>« Prev</span><br><span>Requim of TornadoCash</span>
</a><a class=next href=https://jchauhn.github.io:443/blog/posts/cisco_meraki/><span class=title>Next »</span><br><span>Pentesting cisco meraki</span></a></nav></footer></article></div></main></div><footer class=footer><span>&copy; 2026 <a href=https://jchauhn.github.io:443/blog/>jc's blog</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>