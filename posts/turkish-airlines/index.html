<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=443&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Defeating the Ottomans: Free Wi-Fi on Turkish Airlines | jc's blog</title>
<meta name=keywords content="turkish,airlines,wifi,SNI,domain fronting"><meta name=description content="Breaking through the wifi restrictions in Turkey"><meta name=author content="Me"><link rel=canonical href=https://jchauhn.github.io:443/posts/turkish-airlines/><link crossorigin=anonymous href=/assets/css/stylesheet.705b335eef705bb62a61006cbb665098e195fe597d88ac22db7bb87220664e4b.css integrity="sha256-cFszXu9wW7YqYQBsu2ZQmOGV/ll9iKwi23u4ciBmTks=" rel="preload stylesheet" as=style><link rel=icon href=https://jchauhn.github.io:443/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jchauhn.github.io:443/favicon1616.ico><link rel=icon type=image/png sizes=32x32 href=https://jchauhn.github.io:443/favicon3232.ico><link rel=apple-touch-icon href=https://jchauhn.github.io:443/apple-touch-icon.png><link rel=mask-icon href=https://jchauhn.github.io:443/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://jchauhn.github.io:443/posts/turkish-airlines/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://jchauhn.github.io:443/posts/turkish-airlines/"><meta property="og:site_name" content="jc's blog"><meta property="og:title" content="Defeating the Ottomans: Free Wi-Fi on Turkish Airlines"><meta property="og:description" content="Breaking through the wifi restrictions in Turkey"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-11-18T11:30:03+00:00"><meta property="article:modified_time" content="2025-11-18T11:30:03+00:00"><meta property="article:tag" content="Turkish"><meta property="article:tag" content="Airlines"><meta property="article:tag" content="Wifi"><meta property="article:tag" content="SNI"><meta property="article:tag" content="Domain Fronting"><meta property="og:image" content="https://jchauhn.github.io:443/assets/good-hacker.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jchauhn.github.io:443/assets/good-hacker.png"><meta name=twitter:title content="Defeating the Ottomans: Free Wi-Fi on Turkish Airlines"><meta name=twitter:description content="Breaking through the wifi restrictions in Turkey"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://jchauhn.github.io:443/posts/"},{"@type":"ListItem","position":2,"name":"Defeating the Ottomans: Free Wi-Fi on Turkish Airlines","item":"https://jchauhn.github.io:443/posts/turkish-airlines/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Defeating the Ottomans: Free Wi-Fi on Turkish Airlines","name":"Defeating the Ottomans: Free Wi-Fi on Turkish Airlines","description":"Breaking through the wifi restrictions in Turkey","keywords":["turkish","airlines","wifi","SNI","domain fronting"],"articleBody":"This week , I flew international via Turkish Airlines and got a chance to examine their inflight wifi system.\nInternet access during a flight is a premium feature typically unavailable to the lowly economy traveler. However, most international airlines carve out an exception for messaging apps such as WhatsApp or Messenger and allow (almost) all passengers to message for free. Turkish was no exception.\nTurkish Airline’s internet package was offered in tranches, which allowed unlimited messaging for Miles \u0026 Smiles members which you could sign up during the flight.\nFrom a networking perspective this selective access raises a crucial question - how is the airline router identifying and filtering blacklisted traffic while allowing WhatsApp and other popular messengers.\nIP Blocking. A naive filter can be implemented by dropping all traffic to IP addresses linked to blacklisted services (difficult) or only allowing traffic to whitelisted IPs (easier). This approach however fails in the age of revolving IP addresses and proxies. A majority of services today are delivered via CDNs/reverse proxies and thus by design aren’t assigned permanent IP addresses.\nFurthermore, modern servers and cloud providers often host multiple different services from the same server and an IP block risks blocking legitimate services alongside censored ones.\nDNS Angle Since IP blocking doesn’t work maybe DNS blocking will do it. DNS queries help resolve a domain (such as google.com) to its IP addresses. When a user fetches google.com, the computer sends a query over the internet to a DNS server to fetch the most updated IP address. Since these queries are sent unencrypted in most cases, the airline router can simply drop the DNS queries for blacklisted domains.\nThis too however fails in practice due to DNS caching and DNS-over-HTTPS. Computers often save DNS responses over a certain period of time and thus can resolve previously known domains without DNS queries. Modern browsers like Firefox also go a step further and allow DNS requests to known servers over HTTPS which a router can’t sniff. A user can also connect to a fixed IP proxy and then tunnel all traffic (including DNS) through this connection. Thus, computers can send traffic to known IP addresses and circumvent DNS blocks.\nSo DNS Blocking: FAIL.\nElegant Fix: Handshake sniffing. The actual solution, which solves all the previously mentioned problems, and one which is actually implemented by airlines is TLS Handshake sniffing.\nAll most all internet traffic today is encrypted using TLS or Transport Layer Security. This approach uses Public Key infrastructure to encrypt all connections sent over untrusted channels (which is all Internet traffic). While an explanation of PKI is outside the scope of this blog post, it suffices to understand that all connections made are encrypted (locked) using a a trusted on-device certificate (locking key) and sent over to the server which uses its private key (unlocking key) to decrypt the connection. This prevents anyone without the unlocking key from decrypting the network traffic even if they successfully capture it.\nBefore this can happen, the client and the server need to agree on a keypair they will use for communication which is where TLS handshake comes into play. During this handshake, the client communicates to the server the domain whose key will be used for encrypting internet traffic. This is necessary since a server needs to know which certificate to provide for each individual connection (allowing a single server to host multiple services with different certificates). Crucially, until TLS 1.2 this was done in plaintext allowing an upstream router to sniff the intended destination.\nThis technique (alongside others) was used to enforce mass censorship by several regimes including China and Iran, and it is also used today by most airlines to restrict inflight internet access.\nHowever there exists a loophole in this technique: domain fronting. SNI Domain Fronting. Server Name Indication (SNI) Fronting is an exceedingly simple loophole which exploits the core assumption of SNI in TLS handshakes: The domain used in SNI doesn’t necessarily need to match the actual domain being connected. In my case, I presented wa.me (an allowed domain owned by Whatsapp) alongside a self-signed cert while making a connection to a VPS proxy.\nThis seems counterintuitive at first glance; wouldn’t the server at the other end reject the connection since it is most definitely not wa.me. This is actually true for most servers. Sites like Google and Microsoft will reject such connections by default but a personal server can be configured to accept such connections without fuss.\nIn my case, I used a simple Caddy server with the forward proxy plugin using the following Caddyfile\n# HTTPS forward proxy on 443 bypass.mydomain.org:443 { tls certs/self-cert.pem certs/self-key.pem forward_proxy { basic_auth admin $$2a$14$2N.cz8d4/XwDRfRGRBDfjOoBDSoAoSQBroGkbegcreNlXaUISgas5 # bcrypt hash hide_ip hide_via } } I set this all up before boarding my flight and then came the moment of truth\ncurl --resolve wa.me:443:\u003cVPS_IP\u003e -x https://admin:pass@wa.me ifconfig.co -v * Host wa.me:443 was resolved. * IPv6: (none) * IPv4: \u003cVPS_IP_ADDR\u003e * Trying \u003cVPS_IP_ADDR\u003e:443... * Connected to wa.me (\u003cVPS_IP_ADDR\u003e) port 443 * (304) (OUT), TLS handshake, Client hello (1): * CAfile: /etc/ssl/cert.pem * CApath: none * (304) (IN), TLS handshake, Server hello (2): * (304) (IN), TLS handshake, Unknown (8): * (304) (IN), TLS handshake, Certificate (11): * (304) (IN), TLS handshake, CERT verify (15): * (304) (IN), TLS handshake, Finished (20): * (304) (OUT), TLS handshake, Finished (20): * SSL connection using TLSv1.3 / AEAD-CHACHA20-POLY1305-SHA256 / [blank] / UNDEF * Proxy certificate: * subject: CN=wa.me; O=Meta; C=US * start date: Nov 18 01:39:30 2025 GMT * expire date: Nov 18 01:39:30 2026 GMT * common name: wa.me (matched) * issuer: CN=wa.me; O=Meta; C=US * SSL certificate verify ok. * Proxy auth using Basic with user 'admin' \u003e GET http://ifconfig.ip/ HTTP/1.1 \u003e Host: ifconfig.ip \u003e Proxy-Authorization: Basic \u003cCENSORED\u003e \u003e User-Agent: curl/8.7.1 \u003e Accept: */* \u003e Proxy-Connection: Keep-Alive \u003e * Request completely sent off \u003c HTTP/1.1 200 OK \u003c Alt-Svc: h3=\":443\"; ma=2592000 \u003c Server: Caddy \u003c Date: Tue, 18 Nov 2025 12:29:20 GMT \u003c Content-Length: 0 \u003c * Connection #0 to host wa.me left intact The connection was successful!\nTo ensure that my system will resolve my VPS IP as wa.me to properly set SNI for all connections, I modified my hosts file\n## # Host Database # # localhost is used to configure the loopback interface # when the system is booting. Do not change this entry. ## 127.0.0.1\tlocalhost 255.255.255.255\tbroadcasthost ::1 localhost \u003cVPS_IP_ADDR\u003e wa.me I also flushed the DNS cache of my machine to ensure that the new IP-host mapping was being used properly.\nsudo dscacheutil -flushcache sudo killall -HUP mDNSResponder Finally, I modified my system proxy settings to use my VPS server Despite this successful curl connection, I was unable to get my system to route actual traffic through VPS because of a misconfiguration in my Caddy server.\nI will be testing this further on my return flight back on Turkish.\n","wordCount":"1143","inLanguage":"en","image":"https://jchauhn.github.io:443/assets/good-hacker.png","datePublished":"2025-11-18T11:30:03Z","dateModified":"2025-11-18T11:30:03Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://jchauhn.github.io:443/posts/turkish-airlines/"},"publisher":{"@type":"Organization","name":"jc's blog","logo":{"@type":"ImageObject","url":"https://jchauhn.github.io:443/favicon.ico"}}}</script></head><body id=top><link rel=stylesheet href=/css/extended/chroma.css><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><br></nav></header><div class=layout-with-left-panel><div class=left-panel><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><div id=left-panel><h1>jc's blog</h1><p class=infoblob>Collection of personal ideas & arcane reseach</p><a class=corelink href=/posts>Posts</a>
<a class=corelink href=/>About</a>
<a class=corelink href=https://www.linkedin.com/in/jchauhn/>Contact</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div></div><main class=main><div class=content-area><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Defeating the Ottomans: Free Wi-Fi on Turkish Airlines</h1><div class=post-description>Breaking through the wifi restrictions in Turkey</div><div class=post-meta><span title='2025-11-18 11:30:03 +0000 +0000'>November 18, 2025</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1143 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/turkish-airlines.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#ip-blocking>IP Blocking.</a></li><li><a href=#dns-angle>DNS Angle</a></li><li><a href=#elegant-fix-handshake-sniffing>Elegant Fix: Handshake sniffing.</a></li><li><a href=#sni-domain-fronting>SNI Domain Fronting.</a></li></ul></nav></div></details></div><div class=post-content><p>This week , I flew international via Turkish Airlines and got a chance to examine their inflight wifi system.</p><p>Internet access during a flight is a premium feature typically unavailable to the lowly economy traveler. However, most international airlines carve out an exception for messaging apps such as WhatsApp or Messenger and allow (almost) all passengers to message for free. Turkish was no exception.</p><p>Turkish Airline&rsquo;s internet package was offered in tranches, which allowed unlimited messaging for Miles & Smiles members which you could sign up during the flight.</p><p>From a networking perspective this selective access raises a crucial question - how is the airline router identifying and filtering blacklisted traffic while allowing WhatsApp and other popular messengers.</p><h2 id=ip-blocking>IP Blocking.<a hidden class=anchor aria-hidden=true href=#ip-blocking>#</a></h2><p>A naive filter can be implemented by dropping all traffic to IP addresses linked to blacklisted services (difficult) or only allowing traffic to whitelisted IPs (easier). This approach however fails in the age of revolving IP addresses and proxies. A majority of services today are delivered via CDNs/reverse proxies and thus by design aren&rsquo;t assigned permanent IP addresses.</p><p>Furthermore, modern servers and cloud providers often host multiple different services from the same server and an IP block risks blocking legitimate services alongside censored ones.</p><h2 id=dns-angle>DNS Angle<a hidden class=anchor aria-hidden=true href=#dns-angle>#</a></h2><p>Since IP blocking doesn&rsquo;t work maybe DNS blocking will do it. DNS queries help resolve a domain (such as <code>google.com</code>) to its IP addresses. When a user fetches <code>google.com</code>, the computer sends a query over the internet to a DNS server to fetch the most updated IP address. Since these queries are sent unencrypted in most cases, the airline router can simply drop the DNS queries for blacklisted domains.</p><p>This too however fails in practice due to DNS caching and DNS-over-HTTPS. Computers often save DNS responses over a certain period of time and thus can resolve previously known domains without DNS queries. Modern browsers like Firefox also go a step further and allow DNS requests to known servers over HTTPS which a router can&rsquo;t sniff. A user can also connect to a fixed IP proxy and then tunnel all traffic (including DNS) through this connection. Thus, computers can send traffic to known IP addresses and circumvent DNS blocks.</p><p>So DNS Blocking: FAIL.</p><h2 id=elegant-fix-handshake-sniffing>Elegant Fix: Handshake sniffing.<a hidden class=anchor aria-hidden=true href=#elegant-fix-handshake-sniffing>#</a></h2><p>The actual solution, which solves all the previously mentioned problems, and one which is actually implemented by airlines is TLS Handshake sniffing.</p><p>All most all internet traffic today is encrypted using TLS or Transport Layer Security. This approach uses Public Key infrastructure to encrypt all connections sent over untrusted channels (which is all Internet traffic). While an explanation of PKI is outside the scope of this blog post, it suffices to understand that all connections made are encrypted (locked) using a a trusted on-device certificate (locking key) and sent over to the server which uses its private key (unlocking key) to decrypt the connection. This prevents anyone without the unlocking key from decrypting the network traffic even if they successfully capture it.</p><p>Before this can happen, the client and the server need to agree on a keypair they will use for communication which is where TLS handshake comes into play. During this handshake, the client communicates to the server the domain whose key will be used for encrypting internet traffic. This is necessary since a server needs to know which certificate to provide for each individual connection (allowing a single server to host multiple services with different certificates). Crucially, until TLS 1.2 this was done in plaintext allowing an upstream router to sniff the intended destination.</p><p>This technique (alongside others) was used to enforce mass censorship by several regimes including China and Iran, and it is also used today by most airlines to restrict inflight internet access.</p><p>However there exists a loophole in this technique: domain fronting.
<img alt="Alt text" loading=lazy src=/images/turkish-airlines/sni-diagram.png></p><h2 id=sni-domain-fronting>SNI Domain Fronting.<a hidden class=anchor aria-hidden=true href=#sni-domain-fronting>#</a></h2><p>Server Name Indication (SNI) Fronting is an exceedingly simple loophole which exploits the core assumption of SNI in TLS handshakes: The domain used in SNI doesn&rsquo;t necessarily need to match the actual domain being connected.
In my case, I presented <code>wa.me</code> (an allowed domain owned by Whatsapp) alongside a self-signed cert while making a connection to a VPS proxy.</p><p>This seems counterintuitive at first glance; wouldn&rsquo;t the server at the other end reject the connection since it is most definitely not <code>wa.me</code>. This is actually true for most servers. Sites like Google and Microsoft will reject such connections by default but a personal server can be configured to accept such connections without fuss.</p><p>In my case, I used a simple Caddy server with the <a href=https://github.com/caddyserver/forwardproxy>forward proxy</a> plugin using the following Caddyfile</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-caddy data-lang=caddy><span class=line><span class=cl><span class=c1># HTTPS forward proxy on 443
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=gh>bypass.mydomain.org:443</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>tls</span> <span class=s>certs/self-cert.pem</span> <span class=s>certs/self-key.pem</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>forward_proxy</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>basic_auth</span> <span class=s>admin</span> <span class=s>$$2a$14$2N.cz8d4/XwDRfRGRBDfjOoBDSoAoSQBroGkbegcreNlXaUISgas5</span><span class=c1> # bcrypt hash
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>hide_ip</span>
</span></span><span class=line><span class=cl>                <span class=k>hide_via</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>I set this all up before boarding my flight and then came the moment of truth</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>curl</span> <span class=o>--</span><span class=n>resolve</span> <span class=n>wa</span><span class=o>.</span><span class=n>me</span><span class=p>:</span><span class=mi>443</span><span class=p>:</span><span class=o>&lt;</span><span class=n>VPS_IP</span><span class=o>&gt;</span> <span class=o>-</span><span class=n>x</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>admin</span><span class=p>:</span><span class=k>pass</span><span class=nd>@wa.me</span> <span class=n>ifconfig</span><span class=o>.</span><span class=n>co</span> <span class=o>-</span><span class=n>v</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>Host</span> <span class=n>wa</span><span class=o>.</span><span class=n>me</span><span class=p>:</span><span class=mi>443</span> <span class=n>was</span> <span class=n>resolved</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>IPv6</span><span class=p>:</span> <span class=p>(</span><span class=n>none</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>IPv4</span><span class=p>:</span> <span class=o>&lt;</span><span class=n>VPS_IP_ADDR</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>*</span>   <span class=n>Trying</span> <span class=o>&lt;</span><span class=n>VPS_IP_ADDR</span><span class=o>&gt;</span><span class=p>:</span><span class=mf>443.</span><span class=o>..</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>Connected</span> <span class=n>to</span> <span class=n>wa</span><span class=o>.</span><span class=n>me</span> <span class=p>(</span><span class=o>&lt;</span><span class=n>VPS_IP_ADDR</span><span class=o>&gt;</span><span class=p>)</span> <span class=n>port</span> <span class=mi>443</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=p>(</span><span class=mi>304</span><span class=p>)</span> <span class=p>(</span><span class=n>OUT</span><span class=p>),</span> <span class=n>TLS</span> <span class=n>handshake</span><span class=p>,</span> <span class=n>Client</span> <span class=n>hello</span> <span class=p>(</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl><span class=o>*</span>  <span class=n>CAfile</span><span class=p>:</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>ssl</span><span class=o>/</span><span class=n>cert</span><span class=o>.</span><span class=n>pem</span>
</span></span><span class=line><span class=cl><span class=o>*</span>  <span class=n>CApath</span><span class=p>:</span> <span class=n>none</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=p>(</span><span class=mi>304</span><span class=p>)</span> <span class=p>(</span><span class=n>IN</span><span class=p>),</span> <span class=n>TLS</span> <span class=n>handshake</span><span class=p>,</span> <span class=n>Server</span> <span class=n>hello</span> <span class=p>(</span><span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=p>(</span><span class=mi>304</span><span class=p>)</span> <span class=p>(</span><span class=n>IN</span><span class=p>),</span> <span class=n>TLS</span> <span class=n>handshake</span><span class=p>,</span> <span class=n>Unknown</span> <span class=p>(</span><span class=mi>8</span><span class=p>):</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=p>(</span><span class=mi>304</span><span class=p>)</span> <span class=p>(</span><span class=n>IN</span><span class=p>),</span> <span class=n>TLS</span> <span class=n>handshake</span><span class=p>,</span> <span class=n>Certificate</span> <span class=p>(</span><span class=mi>11</span><span class=p>):</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=p>(</span><span class=mi>304</span><span class=p>)</span> <span class=p>(</span><span class=n>IN</span><span class=p>),</span> <span class=n>TLS</span> <span class=n>handshake</span><span class=p>,</span> <span class=n>CERT</span> <span class=n>verify</span> <span class=p>(</span><span class=mi>15</span><span class=p>):</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=p>(</span><span class=mi>304</span><span class=p>)</span> <span class=p>(</span><span class=n>IN</span><span class=p>),</span> <span class=n>TLS</span> <span class=n>handshake</span><span class=p>,</span> <span class=n>Finished</span> <span class=p>(</span><span class=mi>20</span><span class=p>):</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=p>(</span><span class=mi>304</span><span class=p>)</span> <span class=p>(</span><span class=n>OUT</span><span class=p>),</span> <span class=n>TLS</span> <span class=n>handshake</span><span class=p>,</span> <span class=n>Finished</span> <span class=p>(</span><span class=mi>20</span><span class=p>):</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>SSL</span> <span class=n>connection</span> <span class=n>using</span> <span class=n>TLSv1</span><span class=mf>.3</span> <span class=o>/</span> <span class=n>AEAD</span><span class=o>-</span><span class=n>CHACHA20</span><span class=o>-</span><span class=n>POLY1305</span><span class=o>-</span><span class=n>SHA256</span> <span class=o>/</span> <span class=p>[</span><span class=n>blank</span><span class=p>]</span> <span class=o>/</span> <span class=n>UNDEF</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>Proxy</span> <span class=n>certificate</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=o>*</span>  <span class=n>subject</span><span class=p>:</span> <span class=n>CN</span><span class=o>=</span><span class=n>wa</span><span class=o>.</span><span class=n>me</span><span class=p>;</span> <span class=n>O</span><span class=o>=</span><span class=n>Meta</span><span class=p>;</span> <span class=n>C</span><span class=o>=</span><span class=n>US</span>
</span></span><span class=line><span class=cl><span class=o>*</span>  <span class=n>start</span> <span class=n>date</span><span class=p>:</span> <span class=n>Nov</span> <span class=mi>18</span> <span class=mi>01</span><span class=p>:</span><span class=mi>39</span><span class=p>:</span><span class=mi>30</span> <span class=mi>2025</span> <span class=n>GMT</span>
</span></span><span class=line><span class=cl><span class=o>*</span>  <span class=n>expire</span> <span class=n>date</span><span class=p>:</span> <span class=n>Nov</span> <span class=mi>18</span> <span class=mi>01</span><span class=p>:</span><span class=mi>39</span><span class=p>:</span><span class=mi>30</span> <span class=mi>2026</span> <span class=n>GMT</span>
</span></span><span class=line><span class=cl><span class=o>*</span>  <span class=n>common</span> <span class=n>name</span><span class=p>:</span> <span class=n>wa</span><span class=o>.</span><span class=n>me</span> <span class=p>(</span><span class=n>matched</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>*</span>  <span class=n>issuer</span><span class=p>:</span> <span class=n>CN</span><span class=o>=</span><span class=n>wa</span><span class=o>.</span><span class=n>me</span><span class=p>;</span> <span class=n>O</span><span class=o>=</span><span class=n>Meta</span><span class=p>;</span> <span class=n>C</span><span class=o>=</span><span class=n>US</span>
</span></span><span class=line><span class=cl><span class=o>*</span>  <span class=n>SSL</span> <span class=n>certificate</span> <span class=n>verify</span> <span class=n>ok</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>Proxy</span> <span class=n>auth</span> <span class=n>using</span> <span class=n>Basic</span> <span class=k>with</span> <span class=n>user</span> <span class=s1>&#39;admin&#39;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>GET</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>ifconfig</span><span class=o>.</span><span class=n>ip</span><span class=o>/</span> <span class=n>HTTP</span><span class=o>/</span><span class=mf>1.1</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>Host</span><span class=p>:</span> <span class=n>ifconfig</span><span class=o>.</span><span class=n>ip</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>Proxy</span><span class=o>-</span><span class=n>Authorization</span><span class=p>:</span> <span class=n>Basic</span> <span class=o>&lt;</span><span class=n>CENSORED</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>User</span><span class=o>-</span><span class=n>Agent</span><span class=p>:</span> <span class=n>curl</span><span class=o>/</span><span class=mf>8.7.1</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>Accept</span><span class=p>:</span> <span class=o>*/*</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>Proxy</span><span class=o>-</span><span class=n>Connection</span><span class=p>:</span> <span class=n>Keep</span><span class=o>-</span><span class=n>Alive</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>Request</span> <span class=n>completely</span> <span class=n>sent</span> <span class=n>off</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span> <span class=n>HTTP</span><span class=o>/</span><span class=mf>1.1</span> <span class=mi>200</span> <span class=n>OK</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span> <span class=n>Alt</span><span class=o>-</span><span class=n>Svc</span><span class=p>:</span> <span class=n>h3</span><span class=o>=</span><span class=s2>&#34;:443&#34;</span><span class=p>;</span> <span class=n>ma</span><span class=o>=</span><span class=mi>2592000</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span> <span class=n>Server</span><span class=p>:</span> <span class=n>Caddy</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span> <span class=n>Date</span><span class=p>:</span> <span class=n>Tue</span><span class=p>,</span> <span class=mi>18</span> <span class=n>Nov</span> <span class=mi>2025</span> <span class=mi>12</span><span class=p>:</span><span class=mi>29</span><span class=p>:</span><span class=mi>20</span> <span class=n>GMT</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span> <span class=n>Content</span><span class=o>-</span><span class=n>Length</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>Connection</span> <span class=c1>#0 to host wa.me left intact</span>
</span></span></code></pre></div><p>The connection was successful!</p><p>To ensure that my system will resolve my VPS IP as <code>wa.me</code> to properly set SNI for all connections, I modified my hosts file</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>##</span>
</span></span><span class=line><span class=cl><span class=c1># Host Database</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># localhost is used to configure the loopback interface</span>
</span></span><span class=line><span class=cl><span class=c1># when the system is booting.  Do not change this entry.</span>
</span></span><span class=line><span class=cl><span class=c1>##</span>
</span></span><span class=line><span class=cl><span class=mf>127.0.0.1</span>	<span class=n>localhost</span>
</span></span><span class=line><span class=cl><span class=mf>255.255.255.255</span>	<span class=n>broadcasthost</span>
</span></span><span class=line><span class=cl><span class=p>::</span><span class=mi>1</span>             <span class=n>localhost</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>VPS_IP_ADDR</span><span class=o>&gt;</span> <span class=n>wa</span><span class=o>.</span><span class=n>me</span>
</span></span></code></pre></div><p>I also flushed the DNS cache of my machine to ensure that the new IP-host mapping was being used properly.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>sudo</span> <span class=n>dscacheutil</span> <span class=o>-</span><span class=n>flushcache</span>
</span></span><span class=line><span class=cl><span class=n>sudo</span> <span class=n>killall</span> <span class=o>-</span><span class=no>HUP</span> <span class=n>mDNSResponder</span>
</span></span></code></pre></div><p>Finally, I modified my system proxy settings to use my VPS server
Despite this successful curl connection, I was unable to get my system to route actual traffic through VPS because of a misconfiguration in my Caddy server.</p><p>I will be testing this further on my return flight back on Turkish.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://jchauhn.github.io:443/tags/turkish/>Turkish</a></li><li><a href=https://jchauhn.github.io:443/tags/airlines/>Airlines</a></li><li><a href=https://jchauhn.github.io:443/tags/wifi/>Wifi</a></li><li><a href=https://jchauhn.github.io:443/tags/sni/>SNI</a></li><li><a href=https://jchauhn.github.io:443/tags/domain-fronting/>Domain Fronting</a></li></ul><nav class=paginav><a class=next href=https://jchauhn.github.io:443/posts/ddwrt-mitm/><span class=title>Next »</span><br><span>Intercepting all traffic using DD-WRT</span></a></nav></footer></article></div></main></div><footer class=footer><span>&copy; 2026 <a href=https://jchauhn.github.io:443/>jc's blog</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>